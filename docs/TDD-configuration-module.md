# Technical Design Documentâ€”Configuration module

# Problems to solve

* Invalid configuration have to fail at application startup
* Configuration have to be immutable by default
* While testing, I want to mock/substitute configuration without referring to NestJS configuration service or mocking.
  * While testing, I have to be able to override only properties that are of significance to the tests
  * Config fixtures also have to be validated on creation
* Future changes in how and from where configuration is provided should be transparent to the rest of the
  application
  * Changing configuration provider cannot break unrelated tests 
* Env files should be so easy to generate and update they are no longer sacred artifact passed from developer to developer during onboarding 
  * Env files have to be readable without looking into code
  * I have to be able to generate default env file automatically
  * I have to be able to update current env file automatically, preserving my overrides over default values, and dropping env variables that are no longe relevant
* IDE autocomplete when configuring env
* Autogenerated env variables names

# Decisions made

* Configuration is divided into small per-feature configuration DTOs
* Configuration has to be provided as objects, not as service providing configuration objects
* Config DTOs must be injectable via NestJS IOC container
* Config DTOs must be validated before being provided
* Config DTOs must be deeply frozen, to prevent, accidental modification of configuration at runtime
    * Rejected alternative: making them transient (creating new instance for every consumer), which would have pretty
      heavy performance overhead considering other requirements
* Every configuration property have to have default value
* Not every configuration property have to be fetched from the environment (env variables, env files etc.)
* Every configuration property fetched from environment have to be documented
* Every configuration property fetched from environment have to be registered in central location

[wip]

# Approach
* Every config file exposes static factory provider
* Every provider uses helper function fetch environment values - which gives us ability to register configuration

[wip]



